"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2104],{3998:(e,t,r)=>{r.d(t,{$:()=>l,r:()=>d});var a=r(95155),o=r(12115),n=r(32467),i=r(83101),s=r(64269);let d=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 active:scale-[0.98] hover:scale-[1.02] will-change-transform",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md hover:shadow-lg",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-md hover:shadow-lg",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm hover:shadow-md",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm hover:shadow-md",ghost:"hover:bg-accent/10 hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl"},size:{xs:"h-8 px-2 text-xs",sm:"h-9 px-3 text-sm",default:"h-10 px-4 py-2",lg:"h-11 px-6 text-base",xl:"h-12 px-8 text-lg",icon:"h-10 w-10","icon-sm":"h-8 w-8","icon-lg":"h-12 w-12"},animation:{none:"",scale:"hover:scale-[1.02] active:scale-[0.98]",lift:"hover:-translate-y-0.5 hover:shadow-lg",glow:"hover:shadow-lg hover:shadow-primary/25"}},defaultVariants:{variant:"default",size:"default",animation:"scale"}}),l=o.memo(o.forwardRef((e,t)=>{let{className:r,variant:o,size:i,asChild:l=!1,...c}=e,u=l?n.DX:"button";return(0,a.jsx)(u,{className:(0,s.cn)(d({variant:o,size:i,className:r})),ref:t,...c})}));l.displayName="Button"},11647:(e,t,r)=>{r.d(t,{E:()=>d});var a=r(95155),o=r(12115),n=r(83101),i=r(64269);let s=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}}),d=o.memo(function(e){let{className:t,variant:r,...o}=e;return(0,a.jsx)("div",{className:(0,i.cn)(s({variant:r}),t),...o})})},14585:(e,t,r)=>{r.d(t,{db:()=>d,h:()=>c,j:()=>l});var a=r(52078),o=r(19708),n=r(59253);let i={apiKey:"AIzaSyBU_Q2F0zIMTrIyh5nXERtU3fEtlSX4SH0",authDomain:"mystical-slate-448113-c6.firebaseapp.com",databaseURL:"https://mystical-slate-448113-c6-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"mystical-slate-448113-c6",storageBucket:"mystical-slate-448113-c6.firebasestorage.app",messagingSenderId:"681914071632",appId:"1:681914071632:web:0aaa73e8b439b78251ef55",measurementId:"G-DCCC55ZVBG"},s=null,d=null,l=null,c=null;try{!function(){let e=["apiKey","authDomain","projectId"].filter(e=>!i[e]);if(e.length>0){let t="Missing required Firebase configuration fields: ".concat(e.join(", "));throw Error(t)}}(),s=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)(i),d=(0,o.aU)(s),l=(0,n.xI)(s),(c=new n.HF).addScope("email"),c.addScope("profile")}catch(e){}},64269:(e,t,r)=>{r.d(t,{cn:()=>n});var a=r(2821),o=r(75889);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,o.QP)((0,a.$)(t))}},81661:(e,t,r)=>{r.d(t,{_:()=>b});var a=r(12115),o=r(19708),n=r(14585);let i="comments";function s(e){if(!e.exists())return null;let t=e.data(),r=e=>e?e.toDate?e.toDate():new Date(e.seconds?1e3*e.seconds:e):new Date;return{id:e.id,content:t.content,author:{id:t.authorId,name:t.authorName,avatar:t.authorAvatar,isVerified:t.authorIsVerified||!1,isAnonymous:t.authorIsAnonymous||!1,isGuest:t.authorIsGuest||!1},createdAt:r(t.createdAt),updatedAt:t.updatedAt?r(t.updatedAt):void 0,upvotes:t.upvotes||0,downvotes:t.downvotes||0,replies:[],parentId:t.parentId,isEdited:t.isEdited||!1}}async function d(e){if(!n.db)throw Error("Firestore not initialized");let t=(0,o.P)((0,o.rJ)(n.db,i),(0,o._M)("parentId","==",e));for(let e of(await (0,o.GG)(t)).docs)await d(e.id),await (0,o.kd)(e.ref)}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent";if(!n.db)throw Error("Firestore not initialized");try{let r=(0,o.rJ)(n.db,i),a=(0,o.P)(r,(0,o._M)("parentId","==",e));switch(t){case"recent":a=(0,o.P)(a,(0,o.My)("createdAt","desc"));break;case"oldest":a=(0,o.P)(a,(0,o.My)("createdAt","asc"));break;case"popular":a=(0,o.P)(a,(0,o.My)("upvotes","desc"),(0,o.My)("createdAt","asc"))}let d=await (0,o.GG)(a),c=[];for(let e of d.docs){let r=s(e);r&&(r.replies=await l(r.id,t),c.push(r))}return c}catch(e){return[]}}async function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"recent",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=arguments.length>3?arguments[3]:void 0;if(!n.db)throw Error("Firestore not initialized");try{let d=(0,o.rJ)(n.db,i),c=(0,o.P)(d,(0,o._M)("pageId","==",e));switch(t){case"recent":c=(0,o.P)(c,(0,o.My)("createdAt","desc"));break;case"oldest":c=(0,o.P)(c,(0,o.My)("createdAt","asc"));break;case"popular":c=(0,o.P)(c,(0,o.My)("upvotes","desc"),(0,o.My)("createdAt","desc"))}a&&(c=(0,o.P)(c,(0,o.HM)(a))),c=(0,o.P)(c,(0,o.AB)(r+1));let u=(await (0,o.GG)(c)).docs,h=u.length>r,m=h?u.slice(0,r):u,p=[];for(let e of m){let r=s(e);r&&!r.parentId&&(r.replies=await l(r.id,t),p.push(r))}return{comments:p,hasMore:h,lastDoc:h?m[m.length-1]:void 0}}catch(e){throw e}}async function u(e,t,r,a){if(!n.db)throw Error("Firestore not initialized");try{let d=(0,o.rJ)(n.db,i),l={content:e.trim(),authorId:r.id,authorName:r.name,authorIsVerified:r.isVerified||!1,authorIsAnonymous:r.isAnonymous||!1,authorIsGuest:r.isGuest||!1,pageId:t,createdAt:(0,o.O5)(),upvotes:0,downvotes:0,isEdited:!1};r.avatar&&(l.authorAvatar=r.avatar),a&&(l.parentId=a);let c=await (0,o.gS)(d,l),u=await (0,o.x7)(c),h=s(u);if(!h)throw Error("Failed to create comment");return h}catch(e){throw e}}async function h(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return u(e,t,{id:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return"".concat(e?"anon":"guest","_").concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}(a),name:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?["Anonymous Learner","Anonymous Student","Anonymous User","Guest User","Curious Mind","Learning Explorer"]:["Guest Visitor","Public User","Visitor","Reader","Community Member","Learning Enthusiast"];return t[Math.floor(Math.random()*t.length)]}(a),isAnonymous:a,isGuest:!a,isVerified:!1},r)}async function m(e,t,r){if(!n.db)throw Error("Firestore not initialized");if(!e||!t||!r)throw Error("Invalid parameters for voting");if(!["upvote","downvote"].includes(r))throw Error("Invalid vote type");try{await (0,o.c4)(n.db,async a=>{let s=(0,o.H9)(n.db,i,e),d=(0,o.rJ)(s,"votes"),l=(0,o.H9)(d,t),[c,u]=await Promise.all([a.get(s),a.get(l)]);if(!c.exists())throw Error("Comment not found");let h=c.data(),m=u.exists()?u.data():null,p=0,v=0;m&&("upvote"===m.type&&(p-=1),"downvote"===m.type&&(v-=1)),m&&m.type===r?a.delete(l):("upvote"===r&&(p+=1),"downvote"===r&&(v+=1),a.set(l,{userId:t,type:r,createdAt:(0,o.O5)()}));let w=(h.upvotes||0)+p,f=(h.downvotes||0)+v;a.update(s,{upvotes:w,downvotes:f})})}catch(e){if((null==e?void 0:e.code)==="permission-denied")throw Error("Permission denied - you may not have access to vote on this comment");if((null==e?void 0:e.code)==="not-found")throw Error("Comment not found - it may have been deleted");if((null==e?void 0:e.code)==="unavailable")throw Error("Service temporarily unavailable - please try again later");else if((null==e?void 0:e.code)==="unauthenticated")throw Error("Authentication required - please sign in again");throw e}}async function p(e,t,r){if(!n.db)throw Error("Firestore not initialized");try{let a=(0,o.H9)(n.db,i,e),s=await (0,o.x7)(a);if(!s.exists())throw Error("Comment not found");if(s.data().authorId!==r)throw Error("Unauthorized to edit this comment");await (0,o.mZ)(a,{content:t.trim(),updatedAt:(0,o.O5)(),isEdited:!0})}catch(e){throw e}}async function v(e,t){if(!n.db)throw Error("Firestore not initialized");try{let r=(0,o.H9)(n.db,i,e),a=await (0,o.x7)(r);if(!a.exists())throw Error("Comment not found");if(a.data().authorId!==t)throw Error("Unauthorized to delete this comment");await d(e),await (0,o.kd)(r)}catch(e){throw e}}class w{generateKey(e,t){return"".concat(e,":").concat(t)}isValid(e){return Date.now()-e.timestamp<this.ttl}evictOldest(){if(this.cache.size>=this.maxSize){let e,t=Date.now();for(let[r,a]of this.cache.entries())a.timestamp<t&&(t=a.timestamp,e=r);e&&this.cache.delete(e)}}get(e,t){let r=this.generateKey(e,t),a=this.cache.get(r);return a?this.isValid(a)?(this.cache.delete(r),this.cache.set(r,a),this.stats.hits++,a.data):(this.cache.delete(r),this.stats.misses++,null):(this.stats.misses++,null)}set(e,t,r){let a=this.generateKey(e,t);this.evictOldest();let o={data:structuredClone(r),timestamp:Date.now(),pageId:e,sortBy:t};this.cache.set(a,o),this.stats.size=this.cache.size}invalidate(e){let t=[];for(let[r,a]of this.cache.entries())a.pageId===e&&t.push(r);t.forEach(e=>this.cache.delete(e)),this.stats.size=this.cache.size}clear(){this.cache.clear(),this.stats={hits:0,misses:0,size:0,maxSize:this.maxSize}}getStats(){return{...this.stats}}getHitRate(){let e=this.stats.hits+this.stats.misses;return e>0?this.stats.hits/e*100:0}cleanExpired(){let e=Date.now(),t=[];for(let[r,a]of this.cache.entries())e-a.timestamp>=this.ttl&&t.push(r);t.forEach(e=>this.cache.delete(e)),this.stats.size=this.cache.size}async prefetch(e,t,r){let a=t.map(async t=>{let a=this.generateKey(e,t);if(!this.cache.has(a))try{let a=await r(e,t);this.set(e,t,a)}catch(e){}});await Promise.allSettled(a)}constructor(e=50,t=5){this.cache=new Map,this.maxSize=e,this.ttl=60*t*1e3,this.stats={hits:0,misses:0,size:0,maxSize:e}}}let f=new w;setInterval(()=>{f.cleanExpired()},3e5);class g{startTiming(e){let t=performance.now();return()=>{let r=performance.now()-t;this.recordMetric(e,r)}}recordMetric(e,t){this.metrics.has(e)||this.metrics.set(e,[]);let r=this.metrics.get(e);r.push(t),r.length>100&&r.shift()}getMetrics(e){let t=this.metrics.get(e);return t&&0!==t.length?{avg:t.reduce((e,t)=>e+t,0)/t.length,min:Math.min(...t),max:Math.max(...t),count:t.length}:null}getAllMetrics(){let e={};for(let[t,r]of this.metrics.entries())r.length>0&&(e[t]={avg:r.reduce((e,t)=>e+t,0)/r.length,min:Math.min(...r),max:Math.max(...r),count:r.length});return e}constructor(){this.metrics=new Map}}let y=new g;function b(){let{pageId:e="default-page",userId:t,initialComments:r,anonymousOptions:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,a.useMemo)(()=>({allowAnonymous:!0,anonymousDisplayName:"Anonymous",requireModeration:!1,...o}),[o]),[i,s]=(0,a.useState)({comments:r||[],loading:!1,error:null,submitting:!1,sortBy:"recent"}),[d,l]=(0,a.useState)(1),[w,g]=(0,a.useState)(!1),[b,x]=(0,a.useState)(void 0),[A,I]=(0,a.useState)(!1);(0,a.useRef)(e),(0,a.useRef)(t);let D=(0,a.useMemo)(()=>{let e=t=>t.reduce((t,r)=>{var a;return t+((null==(a=r.replies)?void 0:a.length)||0)+e(r.replies||[])},0);return{totalComments:i.comments.length,totalReplies:e(i.comments)}},[i.comments.length,i.comments]);(0,a.useMemo)(()=>{let e=t=>[...t].sort((e,t)=>{switch(i.sortBy){case"recent":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();case"popular":return t.upvotes-t.downvotes-(e.upvotes-e.downvotes);default:return 0}}).map(t=>({...t,replies:t.replies?e(t.replies):[]}));return e(i.comments)},[i.comments,i.sortBy]);let E=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!e)return;let r=y.startTiming("loadComments");if(!t&&!b){let t=f.get(e,i.sortBy);if(t){s(e=>({...e,comments:t,loading:!1,error:null})),I(!0),r();return}}s(e=>({...e,loading:!0,error:null}));try{let r=await c(e,i.sortBy,50,t?void 0:b),a=t?r.comments:[...i.comments,...r.comments];s(e=>({...e,comments:a,loading:!1})),(t||!b)&&f.set(e,i.sortBy,r.comments),g(r.hasMore),x(r.lastDoc),I(!0)}catch(r){let t=r instanceof Error?r.message.includes("network")?"Network connection error. Please check your internet connection.":r.message.includes("permission")?"Permission denied. You may not have access to view these comments.":"Failed to load comments. Please try again.":"An unexpected error occurred while loading comments.";if(s(e=>({...e,error:t,loading:!1})),!A){let t=[{id:"1",content:"I'm a bit unclear about how condensation forms in the water cycle. Can someone break it down?",author:{id:"user1",name:"Noah Pierre",avatar:void 0,isVerified:!1},createdAt:new Date(Date.now()-348e4),upvotes:25,downvotes:3,replies:[{id:"2",content:"Condensation happens when water vapor cools down and changes back into liquid droplets. It's the step before precipitation. The example with the glass of ice water in the video was a great visual!",author:{id:"user2",name:"Skill Sprout",avatar:void 0,isVerified:!0},createdAt:new Date(Date.now()-48e4),upvotes:2,downvotes:0,replies:[],parentId:"1"}]},{id:"3",content:"I really enjoyed today's lesson on the water cycle! The animations made the processes so much easier to grasp.",author:{id:"user3",name:"Mollie Hall",avatar:void 0,isVerified:!1},createdAt:new Date(Date.now()-18e6),upvotes:8,downvotes:2,replies:[]},{id:"4",content:"How do we measure the amount of water vapor in the air? Is it something we'll cover later?",author:{id:"user4",name:"Lyle Kauffman",avatar:void 0,isVerified:!1},createdAt:new Date(Date.now()-864e5),upvotes:12,downvotes:0,replies:[{id:"5",content:"Yes, I think we'll dive deeper into that in the next module on humidity. But the short answer is: we measure it using a tool called a hygrometer.",author:{id:"user5",name:"Amanda Lowery",avatar:void 0,isVerified:!1},createdAt:new Date(Date.now()-432e5),upvotes:8,downvotes:1,replies:[],parentId:"4"}]},{id:"6",content:"Exactly! The next lesson will cover humidity, and I'm excited to see how it all connects back to the water cycle.",author:{id:"user6",name:"Owen Garcia",avatar:void 0,isVerified:!1},createdAt:new Date(Date.now()-72e5),upvotes:4,downvotes:0,replies:[]},{id:"7",content:"I prefer not to use my real name, but I wanted to say this explanation was really helpful. Thank you!",author:{id:"anon_1704123456789_abc123def",name:"Anonymous Learner",isAnonymous:!0,isVerified:!1},createdAt:new Date(Date.now()-18e5),upvotes:6,downvotes:0,replies:[]},{id:"8",content:"Quick question - does evaporation happen faster in hot weather? I noticed my puddles dry up quicker in summer.",author:{id:"anon_1704123456790_xyz789ghi",name:"Curious Mind",isAnonymous:!0,isVerified:!1},createdAt:new Date(Date.now()-54e5),upvotes:9,downvotes:1,replies:[{id:"9",content:"Yes, absolutely! Higher temperatures provide more energy for water molecules to escape into the air as vapor.",author:{id:"anon_1704123456791_jkl456mno",name:"Guest User",isAnonymous:!0,isVerified:!1},createdAt:new Date(Date.now()-27e5),upvotes:3,downvotes:0,replies:[],parentId:"8"}]},{id:"10",content:"This is so helpful! I'm just browsing without an account and love that I can still participate in the discussion.",author:{id:"guest_1704123456792_pqr789stu",name:"Guest Visitor",isGuest:!0,isVerified:!1},createdAt:new Date(Date.now()-9e5),upvotes:4,downvotes:0,replies:[{id:"11",content:"I agree! It's great that this platform welcomes everyone to share their thoughts.",author:{id:"guest_1704123456793_vwx123yza",name:"Public User",isGuest:!0,isVerified:!1},createdAt:new Date(Date.now()-6e5),upvotes:2,downvotes:0,replies:[],parentId:"10"}]},{id:"12",content:"I'm a teacher and I appreciate how accessible this content is for everyone. No barriers to learning!",author:{id:"guest_1704123456794_bcd456efg",name:"Learning Enthusiast",isGuest:!0,isVerified:!1},createdAt:new Date(Date.now()-18e4),upvotes:7,downvotes:0,replies:[]}];s(e=>({...e,comments:t,loading:!1})),f.set(e,i.sortBy,t),I(!0)}}r()},[e,i.sortBy,b,A,i.comments]);(0,a.useEffect)(()=>{e&&!A&&E(!0)},[e,E,A]),(0,a.useEffect)(()=>{A&&e&&(x(void 0),E(!0))},[i.sortBy]);let k=(0,a.useCallback)(async function(r,a){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!r.trim()||!e)return;if(o&&!n.allowAnonymous)return void s(e=>({...e,error:"Anonymous comments are not allowed"}));if(r.length>2e3)return void s(e=>({...e,error:"Comment is too long. Maximum 2000 characters allowed."}));let i=y.startTiming("submitComment");s(e=>({...e,submitting:!0,error:null}));try{o||!t?await h(r,e,a,o):await u(r,e,{id:t,name:"Current User",isVerified:!1},a),f.invalidate(e),await E(!0),s(e=>({...e,submitting:!1}))}catch(t){let e=t instanceof Error?t.message.includes("quota")?"Comment submission limit reached. Please try again later.":t.message.includes("content")?"Comment contains inappropriate content. Please modify and try again.":"Failed to submit comment. Please try again.":"An unexpected error occurred while submitting your comment.";s(t=>({...t,error:e,submitting:!1}))}i()},[e,t,n.allowAnonymous,E]),M=(0,a.useCallback)(async(e,t)=>k(e,t,!0),[k]),C=(0,a.useCallback)(async(r,a)=>{if(s(e=>({...e,error:null})),!t)return void s(e=>({...e,error:"You must be logged in to vote on comments"}));if(!e)return void s(e=>({...e,error:"Page not initialized. Please refresh the page."}));try{await m(r,t,a),await E(!0)}catch(t){var o,n,i,d;let e="Failed to vote on comment";if(null==t||null==(o=t.message)?void 0:o.includes("Firestore not initialized"))e="Database connection failed. Please refresh the page and try again.";else if(null==t||null==(n=t.message)?void 0:n.includes("Comment not found")){e="This comment no longer exists. Refreshing comments...";try{await E(!0)}catch(e){}return}else(null==t||null==(i=t.message)?void 0:i.includes("permission"))?e="You do not have permission to vote on this comment.":(null==t||null==(d=t.message)?void 0:d.includes("network"))||(null==t?void 0:t.code)==="unavailable"?e="Network error. Please check your connection and try again.":(null==t?void 0:t.code)==="unauthenticated"&&(e="Authentication expired. Please sign in again.");s(t=>({...t,error:e}))}},[t,E,e]),z=(0,a.useCallback)(async(e,r)=>{if(!t)return void s(e=>({...e,error:"You must be logged in to edit comments"}));try{await p(e,r,t),await E(!0)}catch(e){s(e=>({...e,error:"Failed to edit comment"}))}},[t,E]),P=(0,a.useCallback)(async e=>{if(!t)return void s(e=>({...e,error:"You must be logged in to delete comments"}));try{await v(e,t),await E(!0)}catch(e){s(e=>({...e,error:"Failed to delete comment"}))}},[t,E]),V=(0,a.useCallback)(e=>{s(t=>({...t,sortBy:e})),x(void 0)},[]),_=(0,a.useCallback)(async()=>{w&&e&&await E(!1)},[w,e,E]),S=(0,a.useCallback)(async()=>{e&&(x(void 0),await E(!0))},[e,E]);return{state:{...i,comments:i.comments},stats:D,actions:{submitComment:k,submitAnonymousComment:M,voteComment:C,editComment:z,deleteComment:P,setSortBy:V,loadMore:_,refresh:S},hasMore:w,anonymousOptions:n}}}}]);